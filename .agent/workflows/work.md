---
description: タスクを自然言語で指定し、適切なワークフローを自動選択して実行するメタワークフロー
---

# /work - メタワークフロー

## Cross-Reference

```
/go Phase 2 → /work → /new-feature|/bug-fix|/refactor|/spec → /fbl quick (自動) → /checkout
/checkin → /work → /fbl quick (自動) → /checkout
```

> [!TIP]
> **目標達成: 1コマンドで完結**
> `/go "タスク"` だけで実装 + 品質保証 + セッション管理が完了

---

## 使用方法

```
/work "機能Xを実装したい"
/work "ログインのバグを直して"
/work "パフォーマンス改善"
```

---

## プロセス

### Step 1: タスク分析

ユーザーの意図を分析し、適切なワークフローを判定:

| キーワード | 選択されるワークフロー |
|-----------|----------------------|
| 実装、追加、新機能 | `/new-feature` |
| バグ、修正、直して | `/bug-fix` |
| リファクタ、整理、改善 | `/refactor` |
| テスト、検証 | `/test` + `/fbl` |
| エラーチェック、スイープ、精査 | `/error-sweep` |
| デプロイ、リリース | `/deploy` |
| レビュー、確認 | `/debate` |
| マイグレーション | `/db-migrate` |
| 不明 | ユーザーに確認 |

---

### Step 2: 透明性の確保

選択したワークフローを**実行前に表示**し、Autonomy Levelに応じて続行:

#### L0-L1: 確認あり
```markdown
📋 タスク分析結果

**入力**: "ログインのバグを直して"
**判定**: バグ修正タスク

🔧 実行予定のワークフロー:
1. `/bug-fix` - バグ修正ワークフロー

続行しますか？ (Y/n)
```

#### L2-L3: 自動実行
```markdown
📋 タスク分析 → /bug-fix 実行中...
```
計画を1行表示して即座に実行。確認は不要。

> [!NOTE]
> **L2以上でも透明性は維持**: 何が実行されるかは必ず表示する。ただし確認で止まらない。

---

### Step 3: ワークフロー実行

承認後、選択されたワークフローを実行。

複数ワークフローが必要な場合は**連鎖実行**:

```
/work "機能を実装してテストも書いて"
  → /new-feature (実装)
  → /test (テスト作成)
  → /fbl (検証ループ)
```

---

### Step 4: 自動品質保証（Ultimate Agent）

**子ワークフロー完了後、自動的に `/fbl quick` を実行**:

```markdown
# 自動品質保証ルール（AIエージェント向け指示）
# `/fbl quick` を実行する際のガードレール:
# 1. 開始時刻を記録
# 2. 5分（300秒）経過したら強制停止
# 3. タイムアウト時はユーザーに報告して続行
```

**判定ロジック（AIが実行時に遵守）**:

- `/fbl quick` の実行開始から **5分** を超えたら強制停止
- 正常完了 → `✅ 品質保証完了 - 120%品質達成`
- タイムアウト → `⚠️ 品質保証タイムアウト（5分）手動で /fbl を実行してください。`
- エラー → `⚠️ 品質保証で問題検出。/fbl のログを確認してください`

**自動実行内容**:
- Phase 0: Pre-Flight Check（lint, typecheck, test）
- Phase 3: Frontend Layer（視覚確認）
- Phase 7: Completion Report

**エラーハンドリング**:
- ✅ タイムアウト保護（5分）
- ✅ Exit Code判定
- ✅ グレースフルな失敗

**効果**:
- 全ての実装に自動品質保証
- エラーの早期発見
- 120%品質の自動達成
- ユーザー操作ゼロ

> [!NOTE]
> この自動品質保証により、`/go "タスク"` だけで実装から検証まで完全自動化されます。

---

### Step 5: 完了報告

```markdown
✅ /work 完了

**実行したワークフロー**:
- [x] /bug-fix (完了)

**成果物**:
- 修正ファイル: `src/auth/login.ts`
- テスト: 全パス

**次のアクション**:
- `/checkout` でセッション終了
- または次の `/work "タスク"` を指定
```

---

## ワークフロー連鎖パターン

よくあるタスクに対する自動連鎖:

| タスクパターン | 連鎖ワークフロー |
|---------------|-----------------|
| 機能実装（フル） | `/spec` → `/new-feature` → `/test` |
| バグ修正（フル） | `/bug-fix` → `/fbl` |
| 設計レビュー | `/spec` → `/debate deep` |
| リリース準備 | `/test` → `/fbl` → `/deploy` |

---

## オプション

| オプション | 効果 |
|-----------|------|
| `/work --confirm` | L2でも確認ありで実行（慎重モード） |
| `/work --dry-run` | 実行せずに計画のみ表示 |
| `/work --chain` | 複数ワークフロー連鎖を強制 |

> [!TIP]
> L2（Autonomous）ではデフォルトで自動実行。確認が欲しい場合のみ `--confirm` を使用。

---

## 将来拡張（Level 2）

```markdown
# Level 2: auto-checkin/checkout

/work "タスク"
  → 自動で /checkin 相当を実行
  → ワークフロー実行
  → 自動で /checkout 相当を実行

# 結果: 1コマンドで完結
```

---

> [!NOTE]
> `/work` は「何をしたいか」を伝えるだけ。
> ワークフロー選択はAIが判断し、透明性を保って実行する。
