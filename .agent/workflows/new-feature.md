---
description: 新機能を開発する際の標準ワークフロー
---

# 新機能開発ワークフロー

## Cross-Reference

```
/work "新機能" → /spec → /new-feature → /verify → /ship
/go → /work → /new-feature → /verify
```

> [!IMPORTANT]
> Claude Code 公式推奨: **探索 → 計画 → 実装 → コミット** の順序を厳守

## フェーズ概要

| Phase | 内容 | ブロッカー |
|-------|------|-----------|
| 🔍 **探索** | Step 1-2: 理想系定義、First Principles分析 | - |
| 📝 **計画** | Step 3-5: 設計、ADR、テスト戦略 | ユーザー承認必須 |
| 🛠️ **実装** | Step 6-8: コーディング、レビュー、品質ゲート | - |
| 🚀 **コミット** | Step 9-10: デプロイ、振り返り | - |

## 前提条件
- 機能要件が明確であること
- ユーザーストーリーが定義されていること

---

## 🔍 探索フェーズ

> 🧠 **THINK GATE — 計画フェーズ**: `WORKFLOW_CONTRACTS.md` の Core Engagement Matrix を参照。
> Small: H | Medium: H + T(quick) + N(quick) | Large: H + T + N(deep) + I

### 1. 理想系の定義
**目的**: 制約を無視した理想の状態を明確にする

```markdown
以下を定義してください：
1. この機能が完璧に動作したら、ユーザーはどのような体験をするか
2. 技術的な制約がなければ、どのように実装するか
3. この機能の成功をどのように測定するか
```

**出力**: `docs/IDEAL_STATE.md` に追記

---

### 2. First Principles 分析
**目的**: 既存のパターンに囚われず、本質的な解決策を導出する

```markdown
以下を問う：
1. なぜこの機能が必要か？（5-Why）
2. この機能なしで問題を解決する方法はないか？
3. もっとシンプルな解決策はないか？
```

---

## 📝 計画フェーズ

> 🧠 **THINK GATE — 設計フェーズ**: `WORKFLOW_CONTRACTS.md` の Core Engagement Matrix を参照。
> Medium: N(quick) | Large: N(deep) + I

### 3. 設計とADR作成
**目的**: アーキテクチャ決定を文書化し、レビューを受ける

```markdown
以下を作成してください：
1. 設計オプションの列挙
2. 選択したオプションと理由
3. ADR（Architecture Decision Record）
```

**出力**: `docs/DECISIONS.md` に追記

---

### 4. ユーザーレビュー
**目的**: 実装前に設計の承認を得る

#### L0-L1: 承認待ち
```markdown
レビューポイント：
1. 理想系の定義は妥当か
2. 設計オプションの選択は適切か
3. トレードオフの説明は納得できるか
```
**ブロッカー**: 承認を得るまで次のステップに進まない

#### L2: 条件付き自動
以下の場合のみユーザー承認を求める（それ以外は `/debate quick` で自己レビュー）:
- 新ファイル3つ以上の作成
- DB schema変更を伴う
- 外部API連携の新規追加

#### L3: 全自動
`/debate quick` で自己レビューし、問題なければ即実装に進む。

---

### 5. テスト戦略の策定
**目的**: 実装前にテスト戦略を決定する（TDD）

```markdown
以下を定義してください：
1. ユニットテストの対象
2. 統合テストの対象
3. E2Eテストの対象
4. エッジケースのリスト
```

---

## 🛠️ 実装フェーズ

### 6. 実装
// turbo
**目的**: 設計に基づいて実装を進める

```bash
# 開発サーバー起動
pnpm dev

# テスト監視モード
pnpm test:watch
```

**注意事項**:
- TDD: テストを先に書く
- 小さなコミット: 変更は小さく、頻繁にコミット
- PRは小さく: 1つのPRで1つの機能

---

### 7. コードレビュー
**目的**: 品質を担保し、知識を共有する

---

### 8. 品質ゲート通過
// turbo
**目的**: すべての品質基準をクリアする

```bash
pnpm lint && pnpm typecheck && pnpm test && pnpm build
```

---

## 🚀 コミットフェーズ

### 9. デプロイ
**目的**: 変更を本番環境に反映する

**参照**: `/deploy` ワークフロー

---

### 10. 振り返り
**目的**: 学びを文書化し、プロセスを改善する

```markdown
振り返りポイント：
1. うまくいったこと
2. 改善すべきこと
3. 次回に活かす学び
```

**出力**: ボトルネックがあれば `docs/BOTTLENECK.md` に記録

---

### 11. 統合検証（自動）

> 🧠 **THINK GATE — 検証フェーズ**: `WORKFLOW_CONTRACTS.md` の Core Engagement Matrix を参照。
> Small: K(参照) | Medium: K + N(quick) | Large: K + N(deep) + T

実装完了後、`/verify --quick` を自動実行。
直接呼び出し時も `/work` 経由時も同じ品質保証を担保。

- テスト全パス → `/ship` 可能
- テスト失敗 → Step 6 に戻って修正
