---
description: バグ修正の際の標準ワークフロー
---

# バグ修正ワークフロー

## Cross-Reference

```
/work "バグ修正" → /bug-fix → /verify --quick → /ship
/go → /work → /bug-fix → /verify
```

> [!IMPORTANT]
> Claude Code 公式推奨: **探索 → 計画 → 実装 → コミット** の順序を厳守

## フェーズ概要

| Phase | 内容 | ブロッカー |
|-------|------|-----------|
| 🔍 **探索** | Step 1-2: 再現・記録、5-Why分析 | - |
| 📝 **計画** | Step 3-4: バンドエイドチェック、テスト設計 | セキュリティ問題は即報告 |
| 🛠️ **実装** | Step 5-8: 修正、リグレッション、品質ゲート | - |
| 🚀 **コミット** | Step 9-10: デプロイ、振り返り | - |

## 前提条件
- バグが再現可能であること
- 影響範囲が特定されていること

---

## 🔍 探索フェーズ

> 🧠 **THINK GATE — デバッグフェーズ**: `WORKFLOW_CONTRACTS.md` の Core Engagement Matrix を参照。
> Small: H + K | Medium: H + K + T(quick) | Large: H + K + T + N(deep)

### 1. バグの再現と記録
**目的**: バグを確実に再現し、症状を正確に記録する

```markdown
記録すべき情報：
1. 発生環境（OS、ブラウザ、バージョン等）
2. 再現手順
3. 期待される動作
4. 実際の動作
5. エラーメッセージ、スタックトレース
```

---

### 2. First Principles 分析（5-Why）
**目的**: 表面的な症状ではなく、根本原因を特定する

```markdown
## 5-Why分析

1. なぜこのバグが発生したか？
   →
2. なぜ[1の答え]なのか？
   →
3. なぜ[2の答え]なのか？
   →
4. なぜ[3の答え]なのか？
   →
5. なぜ[4の答え]なのか？
   →
```

---

## 📝 計画フェーズ

### 3. バンドエイドチェック
**目的**: 提案する修正がバンドエイド（一時的回避策）でないことを確認

```markdown
チェックリスト：
- [ ] この修正は根本原因を解決しているか？
- [ ] 同じ問題が他の場所で発生しないか？
- [ ] この修正なしでバグを解決する方法はないか？
- [ ] 6ヶ月後にこの修正が技術的負債になっていないか？
```

**重要**: バンドエイドしか選択肢がない場合、以下を実施：
1. `docs/BOTTLENECK.md` に技術的負債として記録
2. 根本解決のためのタスクを作成
3. 期限を設定（最大30日）

---

### 4. テストケースの作成（最初に）
// turbo
**目的**: バグを再現するテストを先に書く（TDD）

```bash
# テストファイルを作成/編集
# バグを再現するテストを書く

pnpm test -- --grep "バグの名前"
```

**確認**: テストが失敗すること（バグを再現している）

---

## 🛠️ 実装フェーズ

### 5. 修正の実装
// turbo
**目的**: テストをパスする最小限の修正を行う

```bash
# 修正を実装

pnpm test -- --grep "バグの名前"
```

**確認**: テストがパスすること

---

### 6. リグレッションチェック
// turbo
**目的**: 修正が他の機能に影響していないことを確認

```bash
pnpm test
pnpm lint
pnpm typecheck
```

---

### 7. コードレビュー
**目的**: 修正の妥当性を第三者が確認

**レビューポイント**:
1. 根本原因が解決されているか
2. 新たな問題を生んでいないか
3. テストは十分か

---

### 8. 品質ゲート通過
// turbo
**目的**: すべての品質基準をクリア

```bash
pnpm lint && pnpm typecheck && pnpm test && pnpm build
```

---

## 🚀 コミットフェーズ

### 9. デプロイ
**目的**: 修正を本番環境に反映

**参照**: `/deploy` ワークフロー

---

### 10. 振り返り
**目的**: 同じバグを二度と起こさないための学び

```markdown
振り返りポイント：
1. なぜこのバグは開発中に見つからなかったか？
2. テストで防げたか？防げるとしたらどんなテストか？
3. 設計で防げたか？
4. プロセス改善で防げたか？
```

**出力**: 学びがあれば `docs/DECISIONS.md` または `docs/PRINCIPLES.md` に追記

---

### 11. 統合検証（自動）

> 🧠 **THINK GATE — 検証フェーズ**: `WORKFLOW_CONTRACTS.md` の Core Engagement Matrix を参照。
> Small: K(参照) | Medium: K + N(quick) | Large: K + N(deep) + T

修正完了後、`/verify --quick` を自動実行。
直接呼び出し時も `/work` 経由時も同じ品質保証を担保。

- テスト全パス → `/ship` 可能
- テスト失敗 → Step 5 に戻って修正
