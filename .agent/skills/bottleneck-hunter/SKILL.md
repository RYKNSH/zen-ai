---
name: Bottleneck Hunter
description: システムのボトルネックを特定し、最適化戦略を提案するスキル
---

# Bottleneck Hunter Skill

## 概要

このスキルは、システム全体のボトルネックを継続的に特定・追跡し、
最も効果的な改善ポイントを見つけ出すためのフレームワークを提供します。

**原則**: 「チェーンは最も弱いリンクと同じ強さしかない」

## 発動条件

- パフォーマンスの問題が報告された時
- 「遅い」「重い」「詰まっている」などの表現がある時
- システムの最適化を検討する時
- 定期的なヘルスチェック時

## ボトルネック検知フレームワーク

### 1. メトリクス収集

```markdown
## システムメトリクス

### 計算リソース
| メトリクス | 現在値 | 閾値 | ステータス |
|-----------|--------|------|----------|
| CPU使用率  | 45%    | 80%  | ✅ 正常   |
| メモリ使用率 | 72%   | 85%  | ⚠️ 注意  |
| ディスクI/O | 120MB/s | 200MB/s | ✅ 正常 |

### アプリケーション
| メトリクス | P50 | P95 | P99 | 閾値 |
|-----------|-----|-----|-----|------|
| API応答時間 | 50ms | 200ms | 500ms | 200ms |
| DB クエリ時間 | 10ms | 50ms | 100ms | 50ms |

### 待ち行列
| キュー | 長さ | 処理速度 | 待機時間 |
|--------|------|---------|---------|
| タスクキュー | 150 | 10/s | 15s |
```

### 2. ボトルネック候補の特定

```markdown
## ボトルネック候補

### 候補1: [名称]
- **症状**: [観察された問題]
- **影響範囲**: [影響を受けるコンポーネント]
- **推定インパクト**: [全体パフォーマンスへの寄与度 %]

### 候補2: [名称]
...
```

### 3. 検証と優先順位付け

```markdown
## ボトルネック検証

### 検証方法
1. [検証ステップ1]
2. [検証ステップ2]

### 結果
| 候補 | 検証結果 | インパクト | 解決難易度 | 優先度 |
|------|---------|-----------|-----------|--------|
| 候補1 | ✅ 確認 | 高 | 中 | 1 |
| 候補2 | ❌ 棄却 | - | - | - |
```

### 4. 解決戦略の立案

```markdown
## 解決戦略

### 最優先ボトルネック: [名称]

#### 短期対策（〜1日）
- [即効性のある対策]

#### 中期対策（〜1週間）
- [根本的な改善策]

#### 長期対策（〜1ヶ月）
- [構造的な改善]

### 期待される効果
- [改善後の予測値]
```

## ボトルネックパターン

### パターン1: CPU律速
**症状**: CPU使用率が高く、他リソースに余裕がある
**対策**:
- アルゴリズムの最適化
- 並列処理の導入
- キャッシュの活用

### パターン2: I/O律速
**症状**: ディスクまたはネットワークI/Oが飽和
**対策**:
- バッファリングの最適化
- 非同期I/Oの導入
- 接続プーリング

### パターン3: メモリ律速
**症状**: メモリ使用率が高く、スワップが発生
**対策**:
- メモリリークの修正
- ストリーミング処理への変更
- キャッシュサイズの調整

### パターン4: 依存サービス律速
**症状**: 外部API/DBの応答待ちがボトルネック
**対策**:
- 非同期呼び出し
- リトライ戦略の最適化
- サーキットブレーカーの導入

### パターン5: ロック競合
**症状**: 同時実行時にスループットが低下
**対策**:
- ロック粒度の細分化
- 楽観的ロックへの変更
- ロックフリーデータ構造の使用

## 出力形式

```markdown
## 🔍 ボトルネック分析レポート

### 調査日時
[タイムスタンプ]

### 特定されたボトルネック
1. **[ボトルネック名]** (優先度: 高)
   - インパクト: [パフォーマンスへの影響 %]
   - 根本原因: [原因の要約]
   - 推奨対策: [対策の要約]

### 推奨アクション
| 対策 | 効果 | コスト | 優先度 |
|-----|------|-------|--------|
| ... | 高   | 低    | 1      |

### 次のステップ
1. [アクション1]
2. [アクション2]
```

## docs/BOTTLENECK.md との連携

このスキルで特定されたボトルネックは、
`docs/BOTTLENECK.md` に記録して継続的に追跡してください。

```markdown
## [日付] ボトルネック: [名称]

### 症状
[特定された症状]

### 根本原因
[分析結果]

### 対策
- [x] 短期対策
- [ ] 中期対策
- [ ] 長期対策

### ステータス
- [x] 調査中
- [ ] 対策実施中
- [ ] 解決済み
```
